<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="tasks-provider">
    <template>
        <iron-ajax auto url="../data/tasks.json" handle-as="json" last-response="{{liveTasks}}"></iron-ajax>
        <app-indexeddb-mirror
                key="tasks"
                data="{{liveTasks}}"
                persisted-data="{{persistedTasks}}">
        </app-indexeddb-mirror>
    </template>
    
    <script>
        Polymer({
            is: 'tasks-provider',
            properties: {
                tasks: {type: Array, notify: true},
                liveTasks: {type: Object, notify: true, observer: 'tasksLoaded'},
                persistedTasks: {type: Object, notify: true, observer: 'tasksLoaded'}
            },
            tasksLoaded: function (n, o) {
                var tasks = [];
                if (n && n.tasks) {
                    for (var i in n.tasks) {
                        tasks.push(n.tasks[i]);
                    }
                }
                this.tasks = tasks;
                console.log('task-provide.tasksLoaded [' + tasks.length + ']');
            },
            ready: function () {
                console.log('tasks-provider ready.');
            }
        });
    </script>
</dom-module>
